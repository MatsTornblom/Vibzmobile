<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Share Test Page</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .status {
      padding: 15px;
      margin: 10px 0;
      border-radius: 8px;
      font-size: 14px;
    }
    .info { background: #e3f2fd; border-left: 4px solid #2196f3; }
    .success { background: #e8f5e9; border-left: 4px solid #4caf50; }
    .error { background: #ffebee; border-left: 4px solid #f44336; }
    button {
      background: #007AFF;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      margin: 10px 0;
    }
    button:active { opacity: 0.7; }
    #logs {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 20px;
    }
    .log-entry {
      margin: 5px 0;
      padding: 5px;
      border-radius: 3px;
    }
    .log-info { color: #4fc3f7; }
    .log-success { color: #81c784; }
    .log-error { color: #e57373; }
    .log-warn { color: #ffb74d; }
  </style>
</head>
<body>
  <h1>WebView Share Test</h1>

  <div id="status-container"></div>

  <button onclick="testShare()">Test Share Function</button>
  <button onclick="clearLogs()">Clear Logs</button>

  <div id="logs"></div>

  <script>
    // Logging function
    function addLog(message, type = 'info') {
      const logs = document.getElementById('logs');
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.className = `log-entry log-${type}`;
      logEntry.textContent = `[${timestamp}] ${message}`;
      logs.appendChild(logEntry);
      logs.scrollTop = logs.scrollHeight;
      console.log(`[${type.toUpperCase()}] ${message}`);
    }

    function showStatus(message, type = 'info') {
      const container = document.getElementById('status-container');
      const status = document.createElement('div');
      status.className = `status ${type}`;
      status.textContent = message;
      container.appendChild(status);

      // Auto remove after 5 seconds
      setTimeout(() => status.remove(), 5000);
    }

    function clearLogs() {
      document.getElementById('logs').innerHTML = '';
      addLog('Logs cleared', 'info');
    }

    // Initialize
    addLog('Page loaded', 'info');
    addLog(`User Agent: ${navigator.userAgent}`, 'info');

    // Check environment
    if (window.isReactNativeWebView) {
      addLog('✓ Running in React Native WebView', 'success');
      showStatus('✓ React Native WebView detected', 'success');
    } else {
      addLog('✗ NOT running in React Native WebView', 'warn');
      showStatus('✗ Not in React Native WebView', 'error');
    }

    if (typeof window.shareContent === 'function') {
      addLog('✓ window.shareContent is available', 'success');
    } else {
      addLog('✗ window.shareContent is NOT available', 'error');
    }

    if (window.ReactNativeWebView && typeof window.ReactNativeWebView.postMessage === 'function') {
      addLog('✓ window.ReactNativeWebView.postMessage is available', 'success');
    } else {
      addLog('✗ window.ReactNativeWebView.postMessage is NOT available', 'error');
    }

    // Listen for messages from native app
    window.addEventListener('message', (event) => {
      addLog(`Received message from native: ${JSON.stringify(event.data)}`, 'info');

      if (event.data && event.data.type === 'shareResult') {
        if (event.data.success) {
          addLog('✓ Share successful!', 'success');
          showStatus('✓ Share successful!', 'success');
          addLog(`Action: ${event.data.action}`, 'info');
          if (event.data.activityType) {
            addLog(`Activity Type: ${event.data.activityType}`, 'info');
          }
        } else {
          addLog(`✗ Share failed: ${event.data.error}`, 'error');
          showStatus(`✗ Share failed: ${event.data.error}`, 'error');
        }
      }
    });

    // Test share function
    function testShare() {
      addLog('testShare() called', 'info');

      if (!window.isReactNativeWebView) {
        addLog('Cannot test: Not in React Native WebView', 'error');
        showStatus('Error: Not in React Native WebView', 'error');
        return;
      }

      if (typeof window.shareContent !== 'function') {
        addLog('Cannot test: window.shareContent not available', 'error');
        showStatus('Error: window.shareContent not available', 'error');
        return;
      }

      const shareData = {
        url: 'https://vibz.world/test',
        title: 'Test Share from WebView',
        text: 'This is a test share message'
      };

      addLog(`Calling window.shareContent with: ${JSON.stringify(shareData)}`, 'info');
      showStatus('Triggering share...', 'info');

      try {
        window.shareContent(shareData);
        addLog('window.shareContent() called successfully', 'success');
      } catch (error) {
        addLog(`Error calling window.shareContent: ${error.message}`, 'error');
        showStatus(`Error: ${error.message}`, 'error');
      }
    }

    addLog('Test page ready', 'success');
  </script>
</body>
</html>
